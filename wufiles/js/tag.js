
var homejson = [{"links": [
	{"source": "0","target": "1","value": "0"},
	{"source": "0","target": "2","value": "0"},
	{"source": "0","target": "3","value": "0"},
	{"source": "0","target": "4","value": "0"},
	{"source": "0","target": "6","value": "0"},
	{"source": "0","target": "5","value": "0"},	
	{"source": "5","target": "11","value": "4"},	
	{"source": "13","target": "17","value": "13"},
	
	{"source": "1","target": "4","value": "1"},
	{"source": "1","target": "12","value": "1"},
	{"source": "1","target": "8","value": "1"},
	{"source": "1","target": "9","value": "1"},
	{"source": "1","target": "10","value": "1"},

	{"source": "2","target": "7","value": "2"},
	{"source": "2","target": "12","value": "2"},
	{"source": "2","target": "13","value": "2"},
	{"source": "2","target": "14","value": "2"},
	{"source": "2","target": "15","value": "2"},
	{"source": "2","target": "16","value": "2"},

	{"source": "3","target": "7","value": "3"},
	{"source": "3","target": "8","value": "3"},
	{"source": "3","target": "9","value": "3"},
	{"source": "3","target": "13","value": "3"}],
	
	"nodes": [
	{"count": 15,"id": "0","name": "伍洲坐标","url": "index.html","sym":"&#xf015"},
	{"count": 13,"id": "1","name": "软件","url": "javascript:zopen(1);","sym":"&#xf188"},
	{"count": 14,"id": "2","name": "无线电","url": "javascript:zopen(2);","sym":"&#xf2ce"},
	{"count": 13,"id": "3","name": "单片机","url": "javascript:zopen(3);","sym":"&#xf2db"},//3
	{"count": 7,"id": "4","name": "技术","url": "javascript:zopen(4);"}, 	
	{"count": 10,"id": "5","name": "资料","url": "javascript:zopen(5);"},
	{"count": 15,"id": "6","name": "关于","url": "about.html","sym":"&#xf0f4"},
	{"count": 5,"group": "2","name": "天线","url": "javascript:zopen(6);"}, 
	{"count": 11,"group": "2","name": "物联网","url": "javascript:zopen(7);"}, 
	{"count": 8,"group": "2","name": "编程","url": "javascript:zopen(8);"},
	{"count": 11,"group": "1","name": "源码","url": "javascript:zopen('9');"},
	{"count": 9,"group": "2","name": "英语","url": "javascript:zopen('a');"},
	{"count": 10,"group": "2","name": "小工具","url": "tools.html"},
	{"count": 9,"group": "2","name": "模块","url": "javascript:zopen('c');"},
	{"count": 6,"group": "2","name": "AIS","url": "javascript:zopen('d');"},
	{"count": 6,"group": "2","name": "433MHz","url": "javascript:zopen('e');"},
	{"count": 6,"group": "2","name": "SDR","url": "javascript:zopen('f');"},
	{"count": 6,"group": "2","name": "蓝牙","url": "javascript:zopen('g');"}]
},
 {"links": [
	{"source": "0","target": "1","value": "0"},
	{"source": "1","target": "2","value": "1"},
	{"source": "2","target": "3","value": "2"},
	{"source": "3","target": "4","value": "4"},
	{"source": "4","target": "6","value": "5"},
	{"source": "3","target": "5","value": "6"},
	{"source": "3","target": "7","value": "3"},	
	{"source": "6","target": "8","value": "6"},
	{"source": "6","target": "9","value": "6"},	
  {"source": "2","target": "16","value": "2"},
	
	{"source": "7","target": "8","value": "1"},
	{"source": "7","target": "9","value": "1"},
	{"source": "7","target": "10","value": "1"},
	{"source": "7","target": "11","value": "1"},
	{"source": "7","target": "12","value": "1"},
	{"source": "7","target": "13","value": "2"},	
	{"source": "7","target": "14","value": "2"},
	{"source": "12","target": "15","value": "12"},
	{"source": "14","target": "25","value": "14"},
		
	{"source": "16","target": "17","value": "2"},
	{"source": "16","target": "18","value": "2"},
	{"source": "16","target": "19","value": "2"},
	{"source": "16","target": "20","value": "3"},
	{"source": "16","target": "21","value": "3"},
	{"source": "16","target": "22","value": "3"},
	{"source": "16","target": "23","value": "3"},
	{"source": "16","target": "24","value": "3"}],
	
	"nodes": [
	{"count": 8,"group": "0","name": "接触电脑","title":" 高中练习五笔首次接触电脑","url": "javascript:;"},
	{"count": 8,"group": "1","name": "安装系统","title":"1998年练习安装电脑系统"},
	{"count": 8,"group": "2","name": "电脑","title":"2000年组装自己的第一台电脑","url": "javascript:;"},
	{"count": 9,"group": "3","name": "上网","title":"2001年申请了ADSL宽带上网","url": "javascript:;"},//3
	{"count": 8,"group": "5","name": "BBS论坛","title":"在自己电脑上用花生壳建立了雷傲论坛","url": "javascript:;"},
	{"count": 5,"group": "2","name": "免费空间","title":"使用过的免费空间sam35.y365.com sam35.8u8.com","url": "#2"}, 
	{"count": 7,"group": "4","name": "午夜的猫","title":"2002建立的第一真正的网上论坛,启用国际域名www.t5y6.com","url": "javascript:;"}, 
	
	{"count": 7,"group": "2","name": "域名","title":"使用过的域名","url": "#7"}, 
	{"count": 7,"group": "2","name": "t5y6.com","title":"第一个域名","url": "#7"}, 
	{"count": 7,"group": "2","name": "sduw.com","title":"杀毒网","url": "#7"}, 
	{"count": 7,"group": "2","name": "wzurl.com","title":"网址导航","url": "#7"}, 
	{"count": 7,"group": "2","name": "domeyes.com","title":"度蜜约","url": "#7"}, 
	{"count": 7,"group": "2","name": "wuroom.com","title":"五维空间,正在使用域名","url": "#7"}, 
	{"count": 7,"group": "2","name": "wurom.com","title":"物联网","url": "#7"}, 
	{"count": 7,"group": "2","name": "wuzhou.xyz","title":"五宙坐标,正在使用域名","url": "index.html"}, 
		
	{"count": 8,"group": "2","name": "博客","url": "#8"},
	{"count": 9,"group": "1","name": "编程","url": "javascript:zopen(8);"},
	{"count": 6,"group": "2","name": "单片机","url": "javascript:zopen(3);"},
	{"count": 7,"group": "2","name": "C/C++","url": "#9"},
	{"count": 8,"group": "6","name": "HTML/CSS","url": "javascript:;"},
	{"count": 5,"group": "2","name": "PHP+MYSQL","url": "#13"},
	{"count": 6,"group": "2","name": "VC","url": "#14"},
	{"count": 6,"group": "2","name": "JavaScript","url": "#15"},
	{"count": 6,"group": "2","name": "Android","url": "#16"},
	{"count": 6,"group": "2","name": "Arm"},
	{"count": 14,"group": "2","name": "伍洲坐标","url": "index.html","sym":"&#xf015"}]
}
];
//var width = 700,height = 700;

(function($){
var id = 0;
var pid = ["#home","#about"];

var obj = document.getElementById('about');
	if(obj){id = 1;}
	else
	{obj = document.getElementById('home');}
	if(!obj) return;
		
//if($("#home").length>0){}else{}

var jsondata = homejson[id];

var width = obj.clientWidth||obj.offsetWidth;
var height= document.documentElement.clientHeight-100;//document.body.clientHeight;
//var height = document.getElementById("tags").offsetHeight;
//var width = document.getElementById("tags").offsetWidth; 

var color = d3.scale.category10();//10种颜色
var force = d3.layout.force().linkDistance(width/10).linkStrength(1).charge(-width/3).size([width, height]);
var svg = d3.select(pid[id]).append("svg").attr("width", width).attr("height", height);
//自动缩放//x坐标点起始位置，y坐标点起始位置，视图宽度，视图高度
//var svg = d3.select("#home").append("svg").attr("preserveAspectRatio", "xMidYMid meet").attr("viewBox", '0 0 '+width+' '+height);
// 背景
//d3.select("body").transition().style("background-color", "grey");
//d3.select("body").append("span").text("Hello, I am CR ");

var nodes = jsondata.nodes.slice(),links = [],bilinks = [];

jsondata.links.forEach(function(link) {
	var s = nodes[link.source],
		t = nodes[link.target],
		i = {}; // intermediate node
    v = link.value;
	nodes.push(i);
	links.push({
		source: s,
		target: i
	}, {
		source: i,
		target: t
	});
	bilinks.push([s, i, t ,v ]);
});

force.nodes(nodes).links(links).start();

var link = svg.selectAll(".link").data(bilinks)
                  .enter().append("path")
                  .attr("class","link")
                  .style("stroke", function(d) { 
                    //console.log(d);
                   /* if(d[3] != null) { 
                      if(d[3] == "1"){
                      //  console.log(d[3]);
                        return color("1");
                      }else{
                        return color("2");
                      }
                    };*/
                    return color(d[3])
                  });

var node = svg.selectAll(".node").data(jsondata.nodes)
                  .enter().append("g")
                  .attr("class", "node")
                  .call(force.drag);

              //小圆   2.5-7.5
              node.append("circle")//.attr("class", "node")                      
              .attr("r", function(d){
                  return d.count;
              })
              .style("fill", function(d) {
                return color(d.count+"")
              });
              
node.append("text")
  .attr("x", -8)
  .attr("y", 6)
  .attr("class", "symbol")
  .html(function(d){ return d.sym;}); 

node.append("svg:a")
  .attr("xlink:href", function(d){return d.url;}) 
  //.attr("title", function(d){return d.title;})
  .append("svg:rect")
  .attr("x", -10)
  .attr("y", -14)
  .attr("height", 28)
  .attr("width", 70)
  .style("fill-opacity", "0");
            
node.append("text")
               .attr("dx", 14)
               .attr("dy",".35em")
                //.attr("class","text")
                //.attr("class", "symbol")          
               .text(function(d) {
                return d.name;//+d.index;
              });
              
force.on("tick", function() {
                link.attr("d", function(d) {
  
                	
                  return "M" + d[0].x + "," + d[0].y + "S"
                      + d[1].x + "," + d[1].y + " "
                      + d[2].x + "," + d[2].y;
                });
                node.attr("transform",function(d) {
                           //x轴 超过宽度回弹
                        if (d.x > width-80) d.x = width-80+Math.ceil(Math.random()*10);
                          //y轴 超过高度回弹
                        if (d.y > height-20) d.y = height-20;
                        if (d.x < 20) d.x = 20;
                        if (d.y < 20) d.y = 20;
                	
                  return "translate(" + d.x + "," + d.y + ")";
                });
              });
      
node.on("mouseover", function(d){ 
if(d.title){
        d3.select("#tooltip")
            .attr("style", "left:" + (d.x+5)+ "px" + ";top:" + (d.y + 15) + "px")
            .select("#tooltip_value")
            .text(d.title);
        //显示提示
    d3.select("#tooltip").classed("hidden", false);
    }
    d3.select(this).attr("r", 10).style("fill", "#FF8000"); 
});
node.on("mouseout", function(d){ 
    //隐藏提示条
    d3.select("#tooltip").classed("hidden", true);
    d3.select(this).attr("r", 6).style("fill", "Black"); 
}); 

})(jQuery);

function Hometree(id){
	//d3.select('svg').selectAll('*').remove();
	d3.select('svg').remove();
	d3tags(id);
}
/*
if(RegExp(/index/).test(window.location.href))
d3tags(0);
if(RegExp(/about/).test(window.location.href))
d3tags(1);
*/
